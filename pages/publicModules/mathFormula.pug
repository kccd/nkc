//-
  /*
  * 加载MathJax及其配置
  * @author pxgo 2025/12/3
  * */
if !isIncluded('mathFormula')
  script.
    window.MathJax = {
      output: {
        fontPath: '/@mathjax/mathjax-newcm-font',
      },
      loader: {
        paths: {
          "mathjax-mhchem-extension": "/@mathjax/mathjax-mhchem-font-extension"
        },
        // 追加 mhchem 拓展以支持化学方程式 \ce{H2O}
        load: ["[tex]/mhchem"],
      },
      startup: {
        // elements: ".math-jax", // 指定渲染的dom或class
        typeset: false,
        ready: function() {
          MathJax.startup.defaultReady();
          MathJax.startup.promise.then(function() {
            NKC.emit("mathJaxRendered");
          });
        }
      },
      options: {
        // processHtmlClass: "", // 指定渲染元素
        // ignoreHtmlClass: "", // 忽略的元素
        ignoreHtmlClass:'type-tip',
        processHtmlClass:"pre-view-formula|render-content",
        menuOptions: {
          settings: {
            enrich: false,         // true to enable semantic-enrichment
            collapsible: true,   // true to enable collapsible math
            speech: true,         // true to enable speech generation
            braille: true,        // true to enable Braille generation
            assistiveMml: true,  // true to enable assistive MathML
          }
        }
      },

      tex: {
        inlineMath: [["$", "$"], ["\\(", "\\)"]],
        displayMath: [ ['$$','$$'], ['\\[','\\]'] ],
        processEscapes: false, // use \$ to produce a literal dollar sign
        packages: { '[+]': ['mhchem'] }
      },
    }

  +includeJS('/mathjax/tex-chtml.js')
